<!DOCTYPE html>
<html lang="es" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmprendeVenta POS</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4f46e5"/>
    <!-- Corrige la referencia al fichero de manifiesto PWA (nombre en minúsculas) -->
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


    <!-- Custom Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        :root {
            --bg-primary: #f9fafb;
            --bg-secondary: #ffffff;
            --bg-accent: #f3f4f6;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --border-color: #d1d5db;
            --primary-color: #4f46e5; /* Indigo 600 */
            --primary-color-hover: #4338ca; /* Indigo 700 */
            --header-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
            --card-shadow: 0 1px 3px 0 rgba(0,0,0,0.07), 0 1px 2px -1px rgba(0,0,0,0.07);
            --modal-overlay: rgba(17, 24, 39, 0.5);
        }
        html.dark {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --bg-accent: #374151;
            --text-primary: #e5e7eb;
            --text-secondary: #9ca3af;
            --border-color: #4b5563;
            --primary-color: #6366f1; /* Indigo 500 */
            --primary-color-hover: #4f46e5; /* Indigo 600 */
            --header-shadow: 0 1px 2px 0 rgba(0,0,0,0.25);
            --card-shadow: 0 1px 3px 0 rgba(0,0,0,0.4), 0 1px 2px -1px rgba(0,0,0,0.4);
            --modal-overlay: rgba(0, 0, 0, 0.7);
        }

        body { font-family: 'Inter', sans-serif; background-color: var(--bg-primary); color: var(--text-primary); -webkit-tap-highlight-color: transparent; }
        .header { background-color: var(--bg-secondary); box-shadow: var(--header-shadow); border-bottom: 1px solid var(--border-color); }
        .drawer { transition: transform 0.3s ease-in-out; background-color: var(--bg-secondary); }
        .drawer.open { transform: translateX(0); } .drawer.closed { transform: translateX(100%); }
        /*
         * Overlay background for modals.  In addition to the theme‑dependent
         * colour defined by `--modal-overlay`, we add a slight blur to the
         * backdrop to improve contrast and focus on the modal content.  This
         * resolves issues where confirm and WhatsApp choice dialogues appear
         * overly transparent and distracting.
         */
        .modal-overlay-bg {
            background-color: var(--modal-overlay);
            backdrop-filter: blur(4px);
        }

        .btn { @apply font-bold py-2 px-4 rounded-lg transition-all transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: var(--primary-color-hover); }
        .btn-secondary { @apply bg-gray-200 text-gray-800 hover:bg-gray-300; }
        .btn-danger { @apply bg-red-600 text-white hover:bg-red-700; }
        .btn-text { @apply bg-transparent text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700; }
        html.dark .btn-secondary { @apply bg-gray-700 text-gray-200 hover:bg-gray-600; }
        
        .modal-input {
            @apply mt-1 block w-full px-3 py-2 border rounded-md shadow-sm;
            @apply bg-gray-50 border-gray-300 text-gray-900;
            @apply dark:bg-gray-700 dark:border-gray-600 dark:text-white;
            @apply focus:outline-none focus:ring-2;
            --tw-ring-color: var(--primary-color);
            border-color: var(--border-color);
        }

        .modal-content > div, .modal-content > form {
            background-color: var(--bg-secondary);
        }
        
        /* New Filter Bar Styles */
        #category-filters {
            background-color: #374151; /* gray-700 */
            padding: 0.5rem;
            border-radius: 0.5rem;
        }
        html.dark #category-filters {
            background-color: #1f2937; /* gray-800 */
        }
        .category-btn {
            @apply px-3 py-1 border-0 rounded-md text-sm transition-colors font-medium;
            color: #d1d5db; /* gray-300 */
            background-color: transparent;
        }
        .category-btn:not(.active):hover {
            background-color: #4b5563; /* gray-600 */
            color: #f9fafb; /* gray-50 */
        }
        .category-btn.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 1px 3px 0 rgba(0,0,0,0.1), 0 1px 2px 0 rgba(0,0,0,0.06);
        }
       
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        #product-grid.list-view { grid-template-columns: 1fr !important; }
        #product-grid.list-view .product-card { flex-direction: row; align-items: center; }
        #product-grid.list-view .product-card .product-image-container { width: 6rem; height: 6rem; flex-shrink: 0; }
        #product-grid.list-view .product-card .product-info-container { flex-grow: 1; padding-left: 1rem; text-align: left;}
        
        .prose { max-width: none; }
    </style>
</head>
<body class="antialiased">

    <div id="config-error" class="hidden fixed inset-0 bg-red-100 text-red-800 p-8 text-center z-50 flex items-center justify-center">
         <div class="bg-white p-8 rounded-lg shadow-2xl max-w-lg">
             <h2 class="text-2xl font-bold mb-4">Error de Configuración</h2>
             <p>Por favor, introduce tu URL y ANON KEY de Supabase en las constantes dentro del script para que la aplicación pueda funcionar.</p>
         </div>
    </div>
    <div id="db-setup-error" class="hidden fixed inset-0 bg-yellow-100 text-yellow-800 p-8 z-50 flex items-center justify-center">
         <div class="bg-white p-8 rounded-lg shadow-2xl max-w-2xl text-left">
             <h2 class="text-2xl font-bold mb-4 text-gray-800">Acción Requerida: Configurar Base de Datos</h2>
             <p class="mb-4 text-gray-700">La aplicación no pudo encontrar las tablas necesarias. Por favor, ejecuta el siguiente script en el <strong>SQL Editor</strong> de tu proyecto de Supabase para configurar la base de datos.</p>
             <div class="relative bg-gray-900 text-white p-4 rounded-md text-sm font-mono max-h-64 overflow-auto">
                 <button id="copy-sql-btn" class="absolute top-2 right-2 bg-gray-700 hover:bg-gray-600 text-white font-bold py-1 px-2 rounded text-xs">Copiar</button>
                 <pre id="sql-script-to-copy" class="whitespace-pre-wrap"></pre>
             </div>
             <p class="mt-4 text-gray-600 text-sm">Después de ejecutar el script, <strong>refresca esta página</strong>.</p>
         </div>
    </div>

    <div id="app" class="pb-20">
        <header class="header sticky top-0 z-20 p-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="logo.png" alt="EmprendeVenta POS Logo" class="h-10">
                <h1 class="text-xl font-bold text-text-primary hidden sm:block">EmprendeVenta POS</h1>
            </div>
            <div class="flex items-center space-x-2">
                <input type="search" id="search-input" placeholder="Buscar producto..." class="border rounded-lg py-1.5 px-3 w-32 md:w-64 focus:outline-none focus:ring-2 bg-gray-50 dark:bg-gray-700 border-border-color" style="--tw-ring-color: var(--primary-color);">
                <button id="install-app-btn" class="hidden btn btn-secondary text-sm p-2 h-10 flex items-center gap-2"><i class="fas fa-download"></i> Instalar</button>
                <button id="theme-toggle-btn" class="p-2 w-10 h-10 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center">
                    <i class="fas fa-moon text-gray-600 dark:text-gray-300"></i>
                </button>
                <button id="auth-button" class="p-2 w-10 h-10 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center">
                    <svg id="auth-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600 dark:text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </button>
            </div>
        </header>

        <main class="p-4">
            <div class="flex justify-between items-center mb-4 flex-wrap gap-4">
                <h2 class="text-2xl font-bold">Catálogo</h2>
                <div class="flex items-center gap-2 flex-wrap">
                    <button id="view-toggle-btn" class="btn btn-secondary p-2 h-10 w-10" title="Cambiar vista">
                        <i class="fas fa-grip-vertical"></i>
                    </button>
                    <button id="btn-manage-products" class="btn btn-primary flex items-center gap-1 py-2 px-3 rounded-md text-sm" title="Gestionar catálogo">
                        <i class="fas fa-boxes-stacked"></i>
                        <!-- Hide text on very small screens to improve layout.  The text becomes visible on small (sm) and larger screens. -->
                        <span class="hidden sm:inline">Catalogo</span>
                    </button>
                    <!-- Botón para que el administrador cree vendedores directamente desde la app -->
                    <button id="btn-create-seller" class="btn btn-primary flex items-center gap-1 py-2 px-3 rounded-md text-sm" title="Crear vendedor">
                        <i class="fas fa-user-plus"></i>
                        <span class="hidden sm:inline">Vendedor</span>
                    </button>
                    <!-- Botón para gestionar vendedores: listar, editar o eliminar -->
                    <button id="btn-manage-sellers" class="btn btn-primary flex items-center gap-1 py-2 px-3 rounded-md text-sm" title="Gestionar vendedores">
                        <i class="fas fa-users"></i>
                        <span class="hidden sm:inline">Vendedores</span>
                    </button>
                    <!-- Botón para gestionar clientes -->
                    <button id="btn-manage-clients" class="btn btn-primary flex items-center gap-1 py-2 px-3 rounded-md text-sm" title="Gestionar clientes">
                        <i class="fas fa-address-book"></i>
                        <span class="hidden sm:inline">Clientes</span>
                    </button>
                </div>
            </div>
            <div id="category-filters" class="mb-4 flex gap-2 overflow-x-auto pb-2"></div>
            <div id="product-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
            <p id="no-products-msg" class="text-center text-text-secondary mt-8 hidden">No se encontraron productos.</p>
        </main>

        <div class="fixed bottom-4 right-4 z-20">
            <button id="cart-button" class="text-white rounded-full p-4 shadow-lg flex items-center justify-center" style="background-color: var(--primary-color);">
                <i class="fas fa-shopping-cart text-xl"></i>
                <span id="cart-item-count" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
            </button>
        </div>
    </div>

    <aside id="cart-drawer" class="drawer closed fixed top-0 right-0 h-full w-full max-w-sm shadow-2xl z-40 flex flex-col">
         <div class="flex items-center justify-between p-4 border-b border-border-color">
            <h3 class="text-xl font-bold">Carrito de Compras</h3>
            <button id="close-cart-button" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"><i class="fas fa-times"></i></button>
        </div>
        <div id="cart-items" class="flex-grow p-4 overflow-y-auto"></div>
        <div id="cart-footer" class="p-4 border-t border-border-color bg-bg-accent">
             <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                     <label for="exchange_rate" class="font-semibold">Tasa Bs:</label>
                     <button id="bcv-toggle-btn" class="p-1 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 text-green-500" title="Activar/Desactivar tasa automática">
                         <i class="fas fa-sync-alt"></i>
                     </button>
                </div>
                <div class="text-right">
                    <input type="number" id="exchange_rate" inputmode="decimal" class="w-24 text-right border rounded-md px-2 py-1 bg-gray-200 dark:bg-gray-600 dark:border-gray-500 transition-colors" readonly value="0.00">
                    <span id="rate-last-update" class="text-xs text-text-secondary block">Cargando...</span>
                    <span id="bcv-rate-display" class="text-xs text-blue-500 block font-semibold hidden"></span>
                </div>
            </div>
            <div class="text-lg font-bold flex justify-between"><span>Total USD:</span><span id="cart-total-usd">$0.00</span></div>
            <div class="text-lg font-bold flex justify-between mb-4"><span>Total Bs:</span><span id="cart-total-bs">Bs 0.00</span></div>
                <!--
                  Organiza los botones del carrito en una rejilla 2x2 para un acceso
                  uniforme.  Ahora se incluyen las acciones de finalizar, venta a
                  crédito, resumen y WhatsApp en una sola rejilla, eliminando
                  botones sueltos y comentarios innecesarios.
                -->
                <div class="grid grid-cols-2 gap-2">
                    <button id="btn-finalize" class="btn btn-primary w-full">Finalizar &amp; Ticket</button>
                    <button id="btn-credit-sale" class="btn btn-secondary w-full">Venta a Crédito</button>
                    <button id="btn-summary" class="btn btn-secondary w-full">Resumen del día</button>
                    <button id="btn-wa" class="btn btn-primary bg-green-500 hover:bg-green-600 w-full">WhatsApp</button>
                </div>
        </div>
    </aside>

    <div id="modal-container" class="hidden">
        <div id="auth-modal" class="modal-content hidden">
            <form id="login-form" class="p-6 rounded-lg shadow-xl w-full max-w-sm">
                <h3 class="text-2xl font-bold mb-4">Iniciar Sesión</h3>
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium text-text-secondary">Email</label>
                    <input type="email" id="email" required class="modal-input">
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-text-secondary">Contraseña</label>
                    <input type="password" id="password" required class="modal-input">
                </div>
                <button type="submit" class="w-full btn btn-primary">Entrar</button>
                <button type="button" id="logout-button" class="w-full btn btn-danger mt-2 hidden">Cerrar Sesión</button>
            </form>
        </div>

        <div id="product-management-modal" class="modal-content hidden">
             <div class="p-6 rounded-lg shadow-xl w-full max-w-3xl h-[90vh] flex flex-col">
                 <div class="flex justify-between items-center mb-4">
                     <h3 class="text-2xl font-bold">Gestionar Catálogo</h3>
                     <div class="flex flex-wrap gap-2">
                         <input type="file" id="json-upload-input" class="hidden" accept=".json,application/json">
                         <button id="export-json-btn" class="btn btn-secondary">Exportar JSON</button>
                         <button id="upload-json-btn" class="btn btn-secondary">Cargar JSON</button>
                         <button id="add-new-product-btn" class="btn btn-primary">Crear Producto</button>
                     </div>
                 </div>
                 
                 <div class="border-b border-gray-200 dark:border-gray-700">
                    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                        <button id="tab-btn-products" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Productos</button>
                        <button id="tab-btn-categories" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Categorías</button>
                    </nav>
                </div>

                 <div class="flex-grow overflow-y-auto pt-4">
                    <!-- Buscador para filtrar productos dentro de la gestión. Ayuda a encontrar rápido sin hacer scroll -->
                    <input type="text" id="product-manage-search" placeholder="Buscar producto" class="w-full p-2 mb-3 border border-border-color rounded-md text-sm" />
                    <div id="product-list-container">
                        <!-- Product list will be rendered here -->
                    </div>
                    <div id="category-list-container" class="hidden">
                        <!-- Category list will be rendered here -->
                    </div>
                 </div>
                 <div class="mt-4 text-right"><button type="button" class="btn-close-modal btn btn-secondary">Cerrar</button></div>
             </div>
        </div>

        <div id="product-form-modal" class="modal-content hidden">
             <form id="product-form" class="p-6 rounded-lg shadow-xl w-full max-w-lg h-[90vh] flex flex-col">
                 <h3 id="product-form-title" class="text-2xl font-bold mb-4"></h3>
                 <input type="hidden" id="product-id">
                 <div class="flex-grow overflow-y-auto pr-2 space-y-4">
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                         <div><label for="product-name" class="block text-sm font-medium">Nombre</label><input type="text" id="product-name" required class="modal-input"></div>
                         <div><label for="product-category" class="block text-sm font-medium">Categoría</label><input type="text" id="product-category" class="modal-input" list="category-list"></div>
                         <div><label for="product-price" class="block text-sm font-medium">Precio (USD)</label><input type="number" id="product-price" inputmode="decimal" required min="0" step="0.01" class="modal-input"></div>
                         <div><label for="product-stock" class="block text-sm font-medium">Stock</label><input type="number" id="product-stock" inputmode="decimal" required min="0" step="1" class="modal-input"></div>
                         <div><label for="product-ideal_stock" class="block text-sm font-medium">Stock Ideal</label><input type="number" id="product-ideal_stock" inputmode="decimal" min="0" step="1" class="modal-input"></div>
                         <div><label for="product-unit" class="block text-sm font-medium">Unidad</label><input type="text" id="product-unit" value="Unidad" class="modal-input"></div>
                         <div class="md:col-span-2"><label for="product-image" class="block text-sm font-medium">URL de Imagen</label><input type="url" id="product-image" class="modal-input"></div>
                     </div>
                     <div class="md:col-span-2"><label for="product-description" class="block text-sm font-medium">Descripción</label><div class="relative"><textarea id="product-description" rows="3" class="modal-input"></textarea><!-- Botón de generación de descripción eliminado --></div></div>
                     <div class="grid grid-cols-2 gap-4"><label class="flex items-center space-x-2"><input type="checkbox" id="product-is_service" class="rounded"><span>Es servicio</span></label><label class="flex items-center space-x-2"><input type="checkbox" id="product-sold_by_weight" class="rounded"><span>Vendido por peso</span></label><label class="flex items-center space-x-2"><input type="checkbox" id="product-sold_by_length" class="rounded"><span>Vendido por metro</span></label><label class="flex items-center space-x-2"><input type="checkbox" id="product-allow_manual_price" class="rounded"><span>Precio manual</span></label></div>
                 </div>
                 <div class="mt-6 flex justify-between items-center">
                     <button type="button" id="delete-product-btn" class="btn btn-danger">Eliminar</button>
                     <div><button type="button" class="btn-close-modal btn btn-secondary mr-2">Cancelar</button><button type="submit" class="btn btn-primary">Guardar</button></div>
                 </div>
             </form>
        </div>
        
        <div id="quantity-modal" class="modal-content hidden">
             <div class="p-6 rounded-lg shadow-xl w-full max-w-xs">
                 <h3 id="quantity-modal-title" class="text-xl font-bold mb-4"></h3>
                 <input type="hidden" id="quantity-product-id">
                 <div class="mb-4"><label id="quantity-label" for="quantity-input" class="block text-sm font-medium"></label><input type="number" id="quantity-input" inputmode="decimal" min="0" step="0.01" required class="modal-input text-lg text-center p-2"></div>
                 <div id="price-input-container" class="mb-4 hidden"><label for="manual-price-input" class="block text-sm font-medium">Precio Manual (USD)</label><input type="number" id="manual-price-input" inputmode="decimal" min="0" step="0.01" class="modal-input text-lg text-center p-2"></div>
                 <div class="flex justify-end space-x-2"><button type="button" class="btn-close-modal btn btn-secondary">Cancelar</button><button id="quantity-modal-confirm" class="btn btn-primary">Aceptar</button></div>
             </div>
        </div>

        <div id="payment-modal" class="modal-content hidden">
            <div class="p-6 rounded-lg shadow-xl w-full max-w-md">
                <h3 class="text-2xl font-bold mb-4">Registrar Pago</h3>
                <div class="mb-4 p-4 rounded-lg bg-indigo-50 dark:bg-gray-800 text-center">
                    <p class="text-sm text-indigo-800 dark:text-indigo-300">Total a Pagar</p>
                    <p id="payment-total-display" class="text-3xl font-bold text-indigo-900 dark:text-indigo-100">$0.00</p>
                </div>
                <div id="payment-methods-container" class="space-y-3"></div>
                <div class="mt-4 p-2 rounded-lg text-center" id="payment-balance-container">
                    <p class="text-sm">Restante</p>
                    <p id="payment-remaining" class="text-xl font-bold text-red-600">$0.00</p>
                </div>
                <div class="mt-6 flex justify-between items-center">
                    <div>
                        <button type="button" class="btn-close-modal btn btn-secondary">Cancelar</button>
                        <button id="confirm-payment-btn" class="btn btn-primary ml-2" disabled>Confirmar</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- El modal de Gemini y sus opciones han sido eliminados porque no se dispone de una API de IA -->
        <!--
        <div id="gemini-modal" class="modal-content hidden">
             <div class="p-6 rounded-lg shadow-xl w-full max-w-lg h-[70vh] flex flex-col">
                 <div class="flex justify-between items-center mb-4"><h3 id="gemini-modal-title" class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-indigo-600">✨ Asistente de IA</h3><button type="button" class="btn-close-modal p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"><i class="fas fa-times"></i></button></div>
                 <div id="gemini-modal-content" class="flex-grow overflow-y-auto bg-primary p-4 rounded-lg prose dark:prose-invert"></div>
                 <div id="gemini-modal-footer" class="mt-4 text-right"><button type="button" class="btn-close-modal btn btn-secondary">Cerrar</button></div>
             </div>
        </div>
        -->

        <!-- Modal para crear vendedores. Visible sólo para administradores. -->
        <div id="create-seller-modal" class="modal-content hidden">
             <form id="create-seller-form" class="p-6 rounded-lg shadow-xl w-full max-w-sm">
                 <h3 class="text-2xl font-bold mb-4">Crear Vendedor</h3>
                 <div class="mb-4">
                     <label for="seller-email" class="block text-sm font-medium text-text-secondary">Email</label>
                     <input type="email" id="seller-email" required class="modal-input">
                 </div>
                 <div class="mb-6">
                     <label for="seller-password" class="block text-sm font-medium text-text-secondary">Contraseña</label>
                     <input type="password" id="seller-password" required class="modal-input">
                 </div>
                 <button type="submit" class="w-full btn btn-primary">Crear</button>
                 <button type="button" class="w-full btn-close-modal btn btn-secondary mt-2">Cancelar</button>
             </form>
        </div>
        <!-- Modal to manage sellers (list, edit, delete) for administrators -->
        <div id="seller-management-modal" class="modal-content hidden">
             <div class="p-6 rounded-lg shadow-xl w-full max-w-md h-[90vh] flex flex-col">
                 <div class="flex justify-between items-center mb-4">
                     <h3 class="text-2xl font-bold">Gestionar Vendedores</h3>
                 </div>
                 <!-- Search bar for filtering sellers by email -->
                 <input type="text" id="seller-search" placeholder="Buscar vendedor" class="w-full p-2 mb-3 border border-border-color rounded-md text-sm" />
                 <div id="seller-list-container" class="flex-grow overflow-y-auto space-y-2">
                     <!-- List of sellers will be rendered here -->
                 </div>
                 <div class="mt-4 text-right">
                     <button type="button" class="btn-close-modal btn btn-secondary">Cerrar</button>
                 </div>
             </div>
        </div>

        <!-- Modal para gestionar clientes: lista de clientes, límite y saldo -->
        <div id="clients-modal" class="modal-content hidden">
             <div class="p-6 rounded-lg shadow-xl w-full max-w-md h-[90vh] flex flex-col">
                 <div class="flex justify-between items-center mb-4">
                     <h3 class="text-2xl font-bold">Gestionar Clientes</h3>
                     <button type="button" id="add-client-btn" class="btn btn-primary text-sm flex items-center gap-1">
                         <i class="fas fa-user-plus"></i>
                         <span class="hidden sm:inline">Nuevo</span>
                     </button>
                 </div>
                 <!-- Campo de búsqueda para filtrar clientes -->
                 <input type="text" id="client-search" placeholder="Buscar cliente" class="w-full p-2 mb-3 border border-border-color rounded-md text-sm" />
                 <div id="client-list-container" class="flex-grow overflow-y-auto space-y-2">
                     <!-- Lista de clientes se renderiza aquí -->
                 </div>
                 <div class="mt-4 text-right">
                     <button type="button" class="btn-close-modal btn btn-secondary">Cerrar</button>
                 </div>
             </div>
        </div>

        <!-- Modal para crear o editar un cliente -->
        <div id="client-form-modal" class="modal-content hidden">
             <form id="client-form" class="p-6 rounded-lg shadow-xl w-full max-w-sm">
                 <h3 id="client-form-title" class="text-2xl font-bold mb-4">Nuevo Cliente</h3>
                 <input type="hidden" id="client-id">
                 <div class="mb-4">
                     <label for="client-name" class="block text-sm font-medium text-text-secondary">Nombre</label>
                     <input type="text" id="client-name" required class="modal-input">
                 </div>
                 <div class="mb-4">
                     <label for="client-phone" class="block text-sm font-medium text-text-secondary">Teléfono</label>
                     <input type="text" id="client-phone" class="modal-input">
                 </div>
                 <div class="mb-4">
                     <label for="client-email" class="block text-sm font-medium text-text-secondary">Email</label>
                     <input type="email" id="client-email" class="modal-input">
                 </div>
                 <div class="mb-4">
                     <label for="client-address" class="block text-sm font-medium text-text-secondary">Dirección</label>
                     <input type="text" id="client-address" class="modal-input">
                 </div>
                 <div class="mb-4">
                     <label for="client-limit" class="block text-sm font-medium text-text-secondary">Límite de Crédito (USD)</label>
                     <input type="number" min="0" step="0.01" id="client-limit" class="modal-input">
                 </div>
                 <div class="mt-6 flex justify-between items-center">
                     <button type="button" class="btn-close-modal btn btn-secondary">Cancelar</button>
                     <button type="submit" class="btn btn-primary">Guardar</button>
                 </div>
             </form>
        </div>

        <!-- Modal para registrar una venta a crédito -->
        <div id="credit-sale-modal" class="modal-content hidden">
             <div class="p-6 rounded-lg shadow-xl w-full max-w-sm">
                 <h3 class="text-2xl font-bold mb-4">Venta a Crédito</h3>
                 <div class="mb-4">
                     <label for="credit-client-select" class="block text-sm font-medium text-text-secondary">Cliente</label>
                     <select id="credit-client-select" class="modal-input"></select>
                 </div>
                 <div class="mb-4 p-3 rounded-lg bg-indigo-50 dark:bg-gray-800 text-center">
                     <p class="text-sm text-indigo-800 dark:text-indigo-300">Total a Crédito</p>
                     <p id="credit-sale-total" class="text-3xl font-bold text-indigo-900 dark:text-indigo-100">$0.00</p>
                 </div>
                 <div class="mt-6 flex justify-between items-center">
                     <button type="button" class="btn-close-modal btn btn-secondary">Cancelar</button>
                     <button id="confirm-credit-sale-btn" class="btn btn-primary">Confirmar</button>
                 </div>
             </div>
        </div>

        <!-- Modal para ver el detalle de las operaciones de un cliente -->
        <div id="client-details-modal" class="modal-content hidden">
            <!--
              Este modal muestra todas las ventas a crédito asociadas a un cliente,
              junto con los productos, subtotales en USD y Bs, pagos registrados y
              la opción de anular una venta si fue realizada por error.  El
              contenido se genera dinámicamente desde original.js.
            -->
            <div class="p-6 rounded-lg shadow-xl w-full max-w-xl h-[90vh] flex flex-col">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 space-y-2 sm:space-y-0">
                    <div class="flex items-center space-x-2">
                        <h3 id="client-details-title" class="text-2xl font-bold">Detalles del Cliente</h3>
                        <!-- Filtro de estado de deudas: Todos, Pendientes o Pagadas -->
                        <select id="client-details-filter" class="border border-gray-300 dark:border-gray-600 rounded-md text-sm px-2 py-1">
                            <option value="all">Todas</option>
                            <option value="pending">Pendientes</option>
                            <option value="paid">Pagadas</option>
                        </select>
                    </div>
                    <button type="button" class="btn-close-modal p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 self-end sm:self-auto">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div id="client-details-body" class="flex-grow overflow-y-auto space-y-4">
                    <!-- Aquí se insertan las tarjetas de ventas por cliente -->
                </div>
                <div class="mt-4 text-right">
                    <button type="button" class="btn-close-modal btn btn-secondary">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

        <!-- Modal para seleccionar opciones del resumen de ventas -->
        <div id="summary-options-modal" class="modal-content hidden">
            <!-- Este modal permite al usuario seleccionar el rango de días y el tipo de pago antes de generar el resumen -->
            <div class="p-6 rounded-lg shadow-xl w-full max-w-sm flex flex-col space-y-4">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold">Opciones de Resumen</h3>
                    <button type="button" class="btn-close-modal p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div>
                    <label for="summary-days" class="block text-sm mb-1">Período (días)</label>
                    <select id="summary-days" class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1">
                        <option value="1">Último día</option>
                        <option value="7">Últimos 7 días</option>
                        <option value="15">Últimos 15 días</option>
                        <option value="30">Últimos 30 días</option>
                    </select>
                </div>
                <div>
                    <label for="summary-payment-filter" class="block text-sm mb-1">Filtrar por método de pago</label>
                    <select id="summary-payment-filter" class="w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1">
                        <option value="">Todos</option>
                        <option value="efectivo_usd">Efectivo USD</option>
                        <option value="efectivo_bs">Efectivo Bs</option>
                        <option value="zelle">Zelle</option>
                        <option value="tarjeta">Tarjeta</option>
                        <option value="pago_movil">Pago Móvil</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" class="btn-close-modal btn btn-secondary">Cancelar</button>
                    <button id="confirm-summary-options-btn" class="btn btn-primary">Generar Resumen</button>
                </div>
            </div>
        </div>
    
    <div id="toast" class="fixed bottom-20 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg opacity-0 transition-opacity duration-300 max-w-md text-center">
         <p id="toast-message"></p>
    </div>

    <footer class="text-center py-6 text-sm text-text-secondary">
        <p>&copy; 2025 EmprendeVenta POS | Tu Negocio, al Día y Creciendo</p>
    </footer>

    <script type="module" src="js/original.js"></script>

</body>
</html>
